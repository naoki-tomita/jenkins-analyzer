# これはなに？

Jenkinsの特定のジョブについて、ジョブの実行結果を引っ張ってきてチャートを表示するアプリケーションです。
ジョブやJenkinsの情報は環境変数で指定できます。

# 使い方

1. [`deno`](https://deno.land/) をインストールします。
2. `.env.template` を参考に `.env` ファイルを作ります。
   - ジョブ名とは、 `job/xxxxx` みたいなやつです。ネストしていると `job/xxxx/job/yyyy` とかになります。
   - パスワードやURLをガッツリ書くので、コミットしないように注意しましょう。
3. `make serve` します。
4. `http://localhost:8080/statics/index.html` にアクセスします。
   - 初回は、.envに設定された情報を元に、過去のジョブの情報を全部取りにいきます。たくさんあると時間がかかります。コンソールにログが出るので、目安にしてください。
   - また、ジョブの情報は1ジョブごとにしか取得できないため、100並列で取りに行きます。負荷がかかるので注意してください。
   - 一応、2回目以降はキャッシュされている(`statics/jobs.json`がそれ)ので、早くなるはずです。
5. `statics/index.html` に画面のプログラムがありますが、適当に書き換えてください。C3.jsでめちゃくちゃ適当に書いています。
   - 30秒以下のステージはチャートから除外しています。
   - `check deploy for production` というジョブを除くようにしています。

# これを使わずに同じことを実現したいのだが

- `wfapi` というのを使っています。
  - `http://<hostname>:<port>/<job/xxxx/job/yyyy>/<id>/wfapi/describe` というURLで
    <id> で指定したジョブの実行時間とか、ステージごとの時間とかが取れます。がんばってループ回して全部とりましょう。取ってどこかに保存しておきましょう。
- あとは保存したデータをよしなに表示するなどしましょう。
